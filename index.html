<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Unbust demo (_VERSION_)</title>
    <link rel="stylesheet" href="_STYLES_FILE_">
</head>
<body>
    <h1>Unbust demo (release <span class="code">_VERSION_</span>)</h1>
    <h3>Cache policy <span class="code">_CACHE_POLICY_</span></h3>
    <div class="text-box">
        This demo of <a href="http://github.com/Archivium/unbust">Archivium cache unbust</a> is re-deployed on a cron job on the 3rd of every month, with <span class="code">UNBUST_CACHE_TIME</span> set to "6 months ago"
        <ul>
            <li>Every deployment, the major version of the stylesheet is incremented, and a versioned <span class="code">styles.css</span> file is generated which is referenced in <span class="code">index.html</span>. Each style contains a different pastel background color.</li>
            <li><span class="code">index.html</span> uses style version <span class="code">_VERSION_</span> this release</li>
            <li>The IFRAME below shows the served <span class="code">subdir/</span> folder which should contain the versioned assets published in the last 6 months (per <span class="code">UNBUST_CACHE_TIME</span>).</li>
            <li>The versioned assets are served with <span class="code">Cache-control: max-age=63072000, immutable</span> which means browsers can cache them up to 2 years, and do not need to re-validate them</li>
            <li>The unversioned entry point <span class="code">index.html</span> is currently served with<span class="code">Cache-Control: max-age=_ENTRY_CACHE_TIME_</span></li>
        </ul>
        The demo is deployed on the following CDNs:
        <ul>
            <li>Cloudflare Pages: <a href="//unbust.pages.dev">https://unbust.pages.dev</a></li>
            <li>Netlify: <a href="//unbust.netlify.app">https://unbust.netlify.app</a></li>
            <li>Github Pages: <a href="//unbust.github.io">https://unbust.github.io</a></li>
        </ul>
    </div>
    <h2>Generated files (UTC times):</h2>
    <div class="iframe-container">
        <iframe src="subdir/generated.txt" frameborder="0"></iframe>
    </div>
    <h2>Full file list (generated + persisted, UTC times):</h2>
    <div class="iframe-container">
        <iframe src="subdir/all-files.txt" frameborder="0"></iframe>
    </div>
    <h2>Cache policies (<span class="localtz"></span> - last deployment: _LAST_DEPLOYMENT_):</h2>
    <div class="_POLICY_TABLE_CLASS_">
    <table>
        <tr>
          <th>Policy</th>
          <th>In effect after</th>
          <th>entry-point cache time</th>
        </tr>
        <tr>
          <td>Hotfix-ready</td>
          <td>_HOTFIX_AFTER_</td>
          <td>_HOTFIX_CACHE_TIME_</td>
        </tr>
        <tr>
          <td>Maintenance-ready</td>
          <td>_MAINTENANCE_AFTER_</td>
          <td>_MAINTENANCE_CACHE_TIME_</td>
        </tr>
        <tr>
          <td>Stable</td>
          <td>_STABLE_AFTER_</td>
          <td>_STABLE_CACHE_TIME_</td>
        </tr>
      </table>
    </div>
    <div class="_POLICY_IMPOSSIBLE_CLASS_">
        <p>This deployment environment does not support setting headers. Cache policy not possible.</p>
    </div>
        <script>
		const utcDateElements = document.querySelectorAll('.udate');

		utcDateElements.forEach((element) => {
			const utcDate = new Date(element.innerText);
			const localDate = utcDate.toLocaleString();
			element.innerText = localDate;
		});

        const localTzElements = document.querySelectorAll('.localtz');

        // Get the local timezone name
		const localTzName = Intl.DateTimeFormat().resolvedOptions().timeZone;

        localTzElements.forEach((element) => {
            element.innerText = localTzName;
        });
	</script></body>
</html>